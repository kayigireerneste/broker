generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  SUPER_ADMIN
  ADMIN
  AGENT
  COMPANY
  CLIENT
}

enum StandingOrderFrequency {
  ANNUALLY
  WEEKLY
  MONTHLY
  NONE
}

model User {
  id                    String   @id @default(uuid())
  firstName             String
  lastName              String
  email                 String   @unique
  phoneCountryCode      String
  phone                 String
  password              String
  idNumber              String
  csdNumber             String?  @unique
  passportPhoto         String
  idDocument            String
  dateOfBirth           DateTime
  gender                String   @default("male")
  country               String
  city                  String
  occupation            String
  investmentExperience  String
  notificationPreferences Json?
  role                  Role     @default(CLIENT)
  isVerified            Boolean  @default(false)
  otp                   String?
  otpExpiresAt          DateTime?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  createdById           String?

  createdBy             User?    @relation("AgentCreatedClients", fields: [createdById], references: [id], onDelete: SetNull)
  createdClients        User[]   @relation("AgentCreatedClients")
  companies             Company[] @relation("UserCompanies")
}

model Company {
  id             String   @id @default(uuid())
  name           String
  ticker         String?  @unique
  description    String?
  sector         String?
  sharePrice     Decimal? @db.Decimal(18, 2)
  totalShares    Int?
  availableShares Int?
  closingPrice         Decimal? @db.Decimal(18, 2)
  previousClosingPrice Decimal? @db.Decimal(18, 2)
  priceChange          String?
  tradedVolume         Decimal? @db.Decimal(18, 2)
  tradedValue          Decimal? @db.Decimal(18, 2)
  snapshotDate         DateTime?
  contract             String?
  createdById    String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  createdBy      User?    @relation("UserCompanies", fields: [createdById], references: [id], onDelete: SetNull)
}

model PurchaseOrder {
  id                     String                  @id @default(uuid())
  clientName             String
  csdNumber              String?
  phone                  String
  email                  String
  address                String
  bestMarketPrice        Boolean                 @default(false)
  priceLimit             Boolean                 @default(false)
  standingOrderNote      String?
  standingFrequency      StandingOrderFrequency?
  additionalInstructions String?
  termsAccepted          Boolean                 @default(false)
  createdAt              DateTime                @default(now())
  updatedAt              DateTime                @updatedAt
  items                  PurchaseOrderItem[]
}

model PurchaseOrderItem {
  id               String         @id @default(uuid())
  security         String
  quantity         Int
  price            Decimal?       @db.Decimal(18, 2)
  purchaseOrderId  String

  purchaseOrder    PurchaseOrder  @relation(fields: [purchaseOrderId], references: [id])
}

model SaleOrder {
  id                     String         @id @default(uuid())
  clientName             String
  csdNumber              String?
  phone                  String
  email                  String
  address                String
  bestMarketPrice        Boolean        @default(false)
  priceLimit             Boolean        @default(false)
  withinTimeLimitNote    String?
  bankName               String?
  bankBranch             String?
  accountNumber          String?
  termsAccepted          Boolean        @default(false)
  createdAt              DateTime       @default(now())
  updatedAt              DateTime       @updatedAt

  items                  SaleOrderItem[]
}

model SaleOrderItem {
  id            String    @id @default(uuid())
  security      String
  quantity      Int
  price         Decimal?  @db.Decimal(18, 2)
  saleOrderId   String

  saleOrder     SaleOrder @relation(fields: [saleOrderId], references: [id])
}